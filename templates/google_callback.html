<!DOCTYPE html>
<html>
<head><title>Processing Login...</title></head>
<body>
    <script>
        const authData = {
            {% if success %}
                type: 'GOOGLE_AUTH_SUCCESS',
                code: '{{ code }}'
            {% else %}
                type: 'GOOGLE_AUTH_ERROR',
                error: '{{ error|default:"Unknown Error" }}'
            {% endif %}
        };

        // 1. Send to Opener
        if (window.opener) {
            // We use '*' to allow local development flexibility (localhost vs 127.0.0.1)
            // In strict production, you might replace '*' with 'https://bmr-sg.cloud'
            window.opener.postMessage(authData, '*');
        }

        // 2. Fallback: LocalStorage (for mobile or blocked openers)
        localStorage.setItem('google_auth_complete', JSON.stringify(authData));

        // 3. Close Popup
        setTimeout(() => { window.close(); }, 100);
    </script>
    <p>Authentication complete. Closing...</p>
</body>
</html>